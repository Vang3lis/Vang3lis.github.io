

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Vang3lis">
  <meta name="keywords" content="">
  <title>BGP协议格式记录 - Vang3lis&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.1.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>0x13</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2023-08-29 16:36" pubdate>
      2023年8月29日 下午
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      39
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">BGP协议格式记录</h1>
            
            <div class="markdown-body" id="post-body">
              <p>[toc]</p>
<h2 id="BGP协议主体格式"><a href="#BGP协议主体格式" class="headerlink" title="BGP协议主体格式"></a>BGP协议主体格式</h2><p><code>BGP</code>协议主要由<code>Header</code>和<code>BGP Message Types</code>组成</p>
<h3 id="Message-Header-Format"><a href="#Message-Header-Format" class="headerlink" title="Message Header Format"></a>Message Header Format</h3><p><code>Header</code>结构为<code>Marker</code>（16字节）、<code>Length</code>（2字节）、<code>Type</code>（1字节）组成<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271#page-11">=&gt; RFC4271 Sec 4.1</a></p>
<pre><code class="hljs yaml"><span class="hljs-number">0</span>                   <span class="hljs-number">1</span>                   <span class="hljs-number">2</span>                   <span class="hljs-number">3</span>
<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span>
<span class="hljs-string">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="hljs-string">|</span>                                                               <span class="hljs-string">|</span>
<span class="hljs-string">+</span>                                                               <span class="hljs-string">+</span>
<span class="hljs-string">|</span>                                                               <span class="hljs-string">|</span>
<span class="hljs-string">+</span>                                                               <span class="hljs-string">+</span>
<span class="hljs-string">|</span>                           <span class="hljs-string">Marker</span>                              <span class="hljs-string">|</span>
<span class="hljs-string">+</span>                                                               <span class="hljs-string">+</span>
<span class="hljs-string">|</span>                                                               <span class="hljs-string">|</span>
<span class="hljs-string">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="hljs-string">|</span>          <span class="hljs-string">Length</span>               <span class="hljs-string">|</span>      <span class="hljs-string">Type</span>     <span class="hljs-string">|</span>
<span class="hljs-string">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></code></pre>

<p><code>Type</code>存在以下状态：</p>
<pre><code class="hljs basic"><span class="hljs-symbol">1 </span>- <span class="hljs-keyword">OPEN</span>
<span class="hljs-symbol">2 </span>- UPDATE
<span class="hljs-symbol">3 </span>- NOTIFICATION
<span class="hljs-symbol">4 </span>- KEEPALIVE
<span class="hljs-symbol">5 </span>- ROUTE-REFRESH
<span class="hljs-symbol">6 </span>- DYNAMIC CAPABILITY</code></pre>

<p>P.S <code>Type: 5 - ROUTE-REFRESH</code>出自 <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc2918.html">RFC2918 Sec 3.</a><br><code>Type: 6 - DYNAMIC CAPABILITY</code>出自 <a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/draft-ietf-idr-dynamic-cap-16#section-3">draft-ietf-idr-dynamic-cap-16 Sec 3.</a></p>
<h3 id="OPEN-Message-Format"><a href="#OPEN-Message-Format" class="headerlink" title="OPEN Message Format"></a>OPEN Message Format</h3><p><code>Open</code>结构为<code>Version</code>（1字节）、<code>My Autonomous System</code>（2字节）、<code>Hold Time</code>（2字节）、<code>BGP Identifier</code>（4字节，<code>BGP IP</code>）、<code>Optional Parameters Length</code>（1字节）、<code>Optional Parameters</code>（变长）<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271#page-12">=&gt; RFC4271 Sec 4.2</a></p>
<pre><code class="hljs asciidoc">0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|    Version    |
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|     My Autonomous System      |
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|           Hold Time           |
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|                         BGP Identifier                        |
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
| Opt Parm Len  |
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|                                                               |
|             Optional Parameters (variable)                    |
|                                                               |
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+</code></pre>

<pre><code class="hljs angelscript"><span class="hljs-number">0</span>                   <span class="hljs-number">1</span>
<span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span>
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...
|  Parm. Type   | Parm. Length  |  Parameter Value (variable)
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...</code></pre>

<p><code>Optional Parameters</code>内部结构为1个或多个<code>&lt;Parameter Type, Parameter Length, Parameter Value&gt;</code>三元组（1字节，1字节，x字节）</p>
<pre><code class="hljs fortran">This field <span class="hljs-keyword">contains</span> a list of <span class="hljs-keyword">optional</span> parameters, <span class="hljs-keyword">in</span> which each <span class="hljs-keyword">parameter</span> is encoded as a &lt;<span class="hljs-keyword">Parameter</span> <span class="hljs-keyword">Type</span>, <span class="hljs-keyword">Parameter</span> Length, <span class="hljs-keyword">Parameter</span> <span class="hljs-keyword">Value</span>&gt; triplet<span class="hljs-number">.</span></code></pre>

<p><code>Parameter Type</code>可以为<code>Reserved</code>（<code>Parameter Type 0</code>）、<code>Authentication (deprecated)</code>（<code>Parameter Type 1</code>）、<code>Capability Codes</code>（<code>Parameter Type 2</code>）</p>
<p>最常用的还是<code>Capability Codes</code>，其内部格式为1个或多个<code>&lt;Capability Code, Capability Length, Capability Value&gt;</code>三元组<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc3392">=&gt; RFC3392 Sec 4.</a></p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+------------------------------+</span>
| Capability Code (1 octet)    |
<span class="hljs-code">+------------------------------+</span>
| Capability Length (1 octet)  |
<span class="hljs-code">+------------------------------+</span>
| Capability Value (variable)  |
<span class="hljs-code">+------------------------------+</span></code></pre>

<p>其中<code>Capability-Code</code>可为如下的值</p>
<p><img src="../../themes/fluid/source/img/BGP-Format/BGP-Open-Capability-Codes.png" srcset="/img/loading.gif" alt="BGP-Open-Capability-Codes.png"><br><a target="_blank" rel="noopener" href="https://www.iana.org/assignments/capability-codes/capability-codes.xhtml">=&gt; IANA-Capability-Codes</a></p>
<p>整个结构如下</p>
<pre><code class="hljs mermaid">graph LR
X(Optional Parameters)--&gt; T1(Opt Param tuple)
T1(Opt Param tuple)--&gt; A(&quot;Parameter Type(if Capability Codes)&quot;)
T1(Opt Param tuple)--&gt; B(Parameter Length)
T1(Opt Param tuple)--&gt; C(Parameter Value)
C(Parameter Value)--&gt; CT1(Cap Code tuple)
CT1(Cap Code tuple)--&gt; CTA(Capability Code)
CT1(Cap Code tuple)--&gt; CTB(Capability Length)
CT1(Cap Code tuple)--&gt; CTC(Capability Value)
C(Parameter Value)--&gt; CT2(...)
X(Optional Parameters)--&gt; T2(...)</code></pre>

<h4 id="1-Multiprotocol-Extensions-for-BGP-4"><a href="#1-Multiprotocol-Extensions-for-BGP-4" class="headerlink" title="(1) Multiprotocol Extensions for BGP-4"></a>(1) Multiprotocol Extensions for BGP-4</h4><p><code>Capability Code</code>字段为1<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>如下：<code>Address Family Identifier</code>（2字节）、<code>Reserved</code>（1字节，默认为0）、<code>Subsequent Address Family Identifier</code>（1字节）</p>
<pre><code class="hljs asciidoc">0       7      15      23      31
<span class="hljs-code">+-------+</span>-------<span class="hljs-code">+-------+</span>-------+
|      AFI      | Res.  | SAFI  |
<span class="hljs-code">+-------+</span>-------<span class="hljs-code">+-------+</span>-------+</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc2858.html#section-7">=&gt; RFC2858 Sec 7.</a></p>
<h4 id="2-Route-Refresh-Capability-for-BGP-4"><a href="#2-Route-Refresh-Capability-for-BGP-4" class="headerlink" title="(2) Route Refresh Capability for BGP-4"></a>(2) Route Refresh Capability for BGP-4</h4><p><code>Capability Code</code>字段为2<br><code>Capability Length</code>字段为0<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc2918.html#section-2">=&gt; RFC2918 Sec 2.</a></p>
<h4 id="3-Outbound-Route-Filtering-Capability"><a href="#3-Outbound-Route-Filtering-Capability" class="headerlink" title="(3) Outbound Route Filtering Capability"></a>(3) Outbound Route Filtering Capability</h4><p><code>Capability Code</code>字段为3<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段为一个或者多个如下结构</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+--------------------------------------------------+</span>
| Address Family Identifier (2 octets)             |
<span class="hljs-code">+--------------------------------------------------+</span>
| Reserved (1 octet)                               |
<span class="hljs-code">+--------------------------------------------------+</span>
| Subsequent Address Family Identifier (1 octet)   |
<span class="hljs-code">+--------------------------------------------------+</span>
| Number of ORFs (1 octet)                         |
<span class="hljs-code">+--------------------------------------------------+</span>
| ORF Type (1 octet)                               |
<span class="hljs-code">+--------------------------------------------------+</span>
| Send/Receive (1 octet)                           |
<span class="hljs-code">+--------------------------------------------------+</span>
| ...                                              |
<span class="hljs-code">+--------------------------------------------------+</span>
| ORF Type (1 octet)                               |
<span class="hljs-code">+--------------------------------------------------+</span>
| Send/Receive (1 octet)                           |
<span class="hljs-code">+--------------------------------------------------+</span></code></pre>

<p>其中<code>Send/Receive</code>值只能为1、2、3<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc5291.html#section-5">=&gt; RFC5291 Sec 5.</a></p>
<h4 id="4-Multiple-routes-to-a-destination-capability-deprecated"><a href="#4-Multiple-routes-to-a-destination-capability-deprecated" class="headerlink" title="(4) Multiple routes to a destination capability (deprecated)"></a>(4) Multiple routes to a destination capability (deprecated)</h4><p><code>Capability Code</code>字段为4<br>但是被弃用<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc8277.html#section-6">=&gt; RFC8277 Sec 6.</a></p>
<h4 id="5-Extended-Next-Hop-Encoding"><a href="#5-Extended-Next-Hop-Encoding" class="headerlink" title="(5) Extended Next Hop Encoding"></a>(5) Extended Next Hop Encoding</h4><p><code>Capability Code</code>字段为5<br><code>Capability Length</code>字段为变长</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+-----------------------------------------------------+</span>
| NLRI AFI - 1 (2 octets)                             |
<span class="hljs-code">+-----------------------------------------------------+</span>
| NLRI SAFI - 1 (2 octets)                            |
<span class="hljs-code">+-----------------------------------------------------+</span>
| Nexthop AFI - 1 (2 octets)                          |
<span class="hljs-code">+-----------------------------------------------------+</span>
| .....                                               |
<span class="hljs-code">+-----------------------------------------------------+</span>
| NLRI AFI - N (2 octets)                             |
<span class="hljs-code">+-----------------------------------------------------+</span>
| NLRI SAFI - N (2 octets)                            |
<span class="hljs-code">+-----------------------------------------------------+</span>
| Nexthop AFI - N (2 octets)                          |
<span class="hljs-code">+-----------------------------------------------------+</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc8950.html#section-4">=&gt; RFC8950 Sec 4.</a></p>
<h4 id="6-BGP-Extended-Message"><a href="#6-BGP-Extended-Message" class="headerlink" title="(6) BGP Extended Message"></a>(6) BGP Extended Message</h4><p><code>Capability Code</code>字段为6<br><code>Capability Length</code>字段为0<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc8654.html#section-3">=&gt; RFC8654 Sec 3.</a></p>
<h4 id="7-BGPsec-Capability"><a href="#7-BGPsec-Capability" class="headerlink" title="(7) BGPsec Capability"></a>(7) BGPsec Capability</h4><p><code>Capability Code</code>字段为7<br><code>Capability Length</code>字段为3<br><code>Capability Value</code>字段如下</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">  0   1   2   3      4      5   6   7</span>
<span class="hljs-code">+---------------------------------------+</span>
| Version          | Dir |  Unassigned  |
<span class="hljs-code">+---------------------------------------+</span>
|                                       |
<span class="hljs-code">+------           AFI              -----+</span>
|                                       |
<span class="hljs-code">+---------------------------------------+</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc8205.html#section-2.1">=&gt; RFC8205 Sec 2.1.</a></p>
<h4 id="8-Multiple-Labels-Capability"><a href="#8-Multiple-Labels-Capability" class="headerlink" title="(8) Multiple Labels Capability"></a>(8) Multiple Labels Capability</h4><p><code>Capability Code</code>字段为8<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段为一个或多个<code>&lt;AFI, SAFI, Count&gt;</code>三元组</p>
<pre><code class="hljs angelscript"> <span class="hljs-number">0</span>                   <span class="hljs-number">1</span>                   <span class="hljs-number">2</span>                   <span class="hljs-number">3</span>
 <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span>
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              AFI              |    SAFI       |    Count      ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~              AFI              |    SAFI       |    Count      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc8277.html#section-2.1">=&gt; RFC8277 Sec 2.1.</a></p>
<h4 id="9-BGP-Role"><a href="#9-BGP-Role" class="headerlink" title="(9) BGP Role"></a>(9) BGP Role</h4><p><code>Capability Code</code>字段为9<br><code>Capability Length</code>字段为1<br><code>Capability Value</code>字段如下</p>
<pre><code class="hljs routeros">Value	Role name (<span class="hljs-keyword">for</span> the local AS)
0	Provider
1	RS
2	RS-Client
3	Customer
4<span class="hljs-built_in">	Peer </span>(i.e., Lateral Peer)
5-255	Unassigned</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc9234.html#name-bgp-role-capability">=&gt; RFC9234 Sec 4.1.</a></p>
<h4 id="64-Graceful-Restart-Capability"><a href="#64-Graceful-Restart-Capability" class="headerlink" title="(64) Graceful Restart Capability"></a>(64) Graceful Restart Capability</h4><p><code>Capability Code</code>字段为64<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段为<code>ReStart Flags</code>、<code>Restart Time in seconds</code>和一个或多个<code>&lt;AFI, SAFI, Flags for Address Family&gt;</code>三元组</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+--------------------------------------------------+</span>
| Restart Flags (4 bits)                           |
<span class="hljs-code">+--------------------------------------------------+</span>
| Restart Time in seconds (12 bits)                |
<span class="hljs-code">+--------------------------------------------------+</span>
| Address Family Identifier (16 bits)              |
<span class="hljs-code">+--------------------------------------------------+</span>
| Subsequent Address Family Identifier (8 bits)    |
<span class="hljs-code">+--------------------------------------------------+</span>
| Flags for Address Family (8 bits)                |
<span class="hljs-code">+--------------------------------------------------+</span>
| ...                                              |
<span class="hljs-code">+--------------------------------------------------+</span>
| Address Family Identifier (16 bits)              |
<span class="hljs-code">+--------------------------------------------------+</span>
| Subsequent Address Family Identifier (8 bits)    |
<span class="hljs-code">+--------------------------------------------------+</span>
| Flags for Address Family (8 bits)                |
<span class="hljs-code">+--------------------------------------------------+</span>


Restart Flags:
<span class="hljs-code"> 0 1 2 3</span>
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|R|Resv.|
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+

Flags for Address Family:
<span class="hljs-code"> 0 1 2 3 4 5 6 7</span>
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|F|   Reserved  |
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4724.html#section-3">=&gt; RFC4724 Sec 3.</a></p>
<h4 id="65-Support-for-4-octet-AS-number-capability"><a href="#65-Support-for-4-octet-AS-number-capability" class="headerlink" title="(65) Support for 4-octet AS number capability"></a>(65) Support for 4-octet AS number capability</h4><p><code>Capability Code</code>字段为65<br><code>Capability Length</code>字段为4<br><code>Capability Value</code>字段为4字节的<code>AS number</code><br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc6793.html#section-3">=&gt; RFC6793 Sec 3.</a></p>
<h4 id="67-Support-for-Dynamic-Capability-capability-specific"><a href="#67-Support-for-Dynamic-Capability-capability-specific" class="headerlink" title="(67) Support for Dynamic Capability (capability specific)"></a>(67) Support for Dynamic Capability (capability specific)</h4><p><code>Capability Code</code>字段为67<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段是一串<code>capability codes</code>，每个一字节</p>
<pre><code class="hljs livecodeserver">The Capability Value field consists <span class="hljs-keyword">of</span> <span class="hljs-keyword">a</span> list <span class="hljs-keyword">of</span> capability codes (<span class="hljs-literal">one</span>-octet <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span>) that specify <span class="hljs-keyword">the</span> capabilities that MAY be revised dynamically <span class="hljs-keyword">by</span> <span class="hljs-keyword">the</span> remote speaker.</code></pre>
<p><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/draft-ietf-idr-dynamic-cap-16#section-2">=&gt; draft-ietf-idr-dynamic-cap-16 Sec 2.</a></p>
<h4 id="68-Multisession-BGP-Capability"><a href="#68-Multisession-BGP-Capability" class="headerlink" title="(68) Multisession BGP Capability"></a>(68) Multisession BGP Capability</h4><p><code>Capability Code</code>字段为68<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段是一个<code>Flags</code>（<code>G</code>+<code>Reserved</code>）和0个或多个<code>capability codes</code>用于区别不同的组</p>
<pre><code class="hljs asciidoc"><span class="hljs-code"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5</span>
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|G|  Reserved   |  Session Id   ~
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+</code></pre>
<p><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/draft-ietf-idr-bgp-multisession-07#section-4">=&gt; draft-ietf-idr-bgp-multisession-07 Sec 4.</a> </p>
<h4 id="69-ADD-PATH-Capability"><a href="#69-ADD-PATH-Capability" class="headerlink" title="(69) ADD-PATH Capability"></a>(69) ADD-PATH Capability</h4><p><code>Capability Code</code>字段为69<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段为一个或多个<code>&lt;AFI, SAFI, Send/Receive&gt;</code>三元组</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+------------------------------------------------+</span>
| Address Family Identifier (2 octets)           |
<span class="hljs-code">+------------------------------------------------+</span>
| Subsequent Address Family Identifier (1 octet) |
<span class="hljs-code">+------------------------------------------------+</span>
| Send/Receive (1 octet)                         |
<span class="hljs-code">+------------------------------------------------+</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7911.html#section-4">=&gt; RFC7911 Sec 4.</a></p>
<h4 id="70-Enhanced-Route-Refresh-Capability"><a href="#70-Enhanced-Route-Refresh-Capability" class="headerlink" title="(70) Enhanced Route Refresh Capability"></a>(70) Enhanced Route Refresh Capability</h4><p><code>Capability Code</code>字段为70<br><code>Capability Length</code>字段为0<br><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc7313.html#section-3.1">=&gt; RFC7313 Sec 3.1.</a></p>
<h4 id="71-Long-Lived-Graceful-Restart-LLGR-Capability"><a href="#71-Long-Lived-Graceful-Restart-LLGR-Capability" class="headerlink" title="(71) Long-Lived Graceful Restart (LLGR) Capability"></a>(71) Long-Lived Graceful Restart (LLGR) Capability</h4><p><code>Capability Code</code>字段为71<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段为0个或多个<code>&lt;AFI, SAFI, Flags, Long-lived Stale Time&gt;</code>四元组</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+--------------------------------------------------+</span>
| Address Family Identifier (16 bits)              |
<span class="hljs-code">+--------------------------------------------------+</span>
| Subsequent Address Family Identifier (8 bits)    |
<span class="hljs-code">+--------------------------------------------------+</span>
| Flags for Address Family (8 bits)                |
<span class="hljs-code">+--------------------------------------------------+</span>
| Long-lived Stale Time (24 bits)                  |
<span class="hljs-code">+--------------------------------------------------+</span>
| ...                                              |
<span class="hljs-code">+--------------------------------------------------+</span>
| Address Family Identifier (16 bits)              |
<span class="hljs-code">+--------------------------------------------------+</span>
| Subsequent Address Family Identifier (8 bits)    |
<span class="hljs-code">+--------------------------------------------------+</span>
| Flags for Address Family (8 bits)                |
<span class="hljs-code">+--------------------------------------------------+</span>
| Long-lived Stale Time (24 bits)                  |
<span class="hljs-code">+--------------------------------------------------+</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://www.ietf.org/archive/id/draft-ietf-idr-long-lived-gr-06.html#section-3.1">=&gt; RFC-ietf-idr-long-lived-gr-06 Sec 3.1</a></p>
<h4 id="72-Routing-Policy-Distribution"><a href="#72-Routing-Policy-Distribution" class="headerlink" title="(72) Routing Policy Distribution"></a>(72) Routing Policy Distribution</h4><p><code>Capability Code</code>字段为72<br><code>Capability Length</code>字段为变长<br><code>Capability Value</code>字段为1个或多个<code>&lt;AFI, SAFI, Send/Receive&gt;</code>三元组</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+--------------------------------------------------+</span>
|  Address Family Identifier (2 octets)            |
<span class="hljs-code">+--------------------------------------------------+</span>
|  Subsequent Address Family Identifier (1 octet)  |
<span class="hljs-code">+--------------------------------------------------+</span>
|  Send/Receive (1 octet)                          |
<span class="hljs-code">+--------------------------------------------------+</span></code></pre>
<p><a target="_blank" rel="noopener" href="https://datatracker.ietf.org/doc/html/draft-ietf-idr-rpd-04#section-4.3">=&gt; draft-ietf-idr-rpd-04 Sec 4.3</a></p>
<h4 id="128-Prestandard-Route-Refresh-deprecated"><a href="#128-Prestandard-Route-Refresh-deprecated" class="headerlink" title="(128) Prestandard Route Refresh (deprecated)"></a>(128) Prestandard Route Refresh (deprecated)</h4><p>同 (2) Route Refresh Capability for BGP-4</p>
<h4 id="130-Prestandard-Outbound-Route-Filtering-deprecated"><a href="#130-Prestandard-Outbound-Route-Filtering-deprecated" class="headerlink" title="(130) Prestandard Outbound Route Filtering (deprecated)"></a>(130) Prestandard Outbound Route Filtering (deprecated)</h4><p>同 (3) Outbound Route Filtering Capability </p>
<h3 id="UPDATE-Message-Format"><a href="#UPDATE-Message-Format" class="headerlink" title="UPDATE Message Format"></a>UPDATE Message Format</h3><p><code>UPDATE Message</code>主要用来构建描述各种自治域的关系图，用于向<code>peer</code>通告共享公共路径属性的可行路由或者撤回多个不可行路由</p>
<p><code>update</code>结构为<code>Withdrawn Routes Length</code>（2字节）、<code>Withdrawn Routes</code>（变长）、<code>Total Path Attribute Length</code>（2字节）、<code>Path Attributes</code>（变长，其长度值为前一个字段）、<code>Network Layer Reachability Information</code>（变长，其长度值为<code>Header</code>长度减去<code>Total Path Attribute Length</code>）</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+-----------------------------------------------------+</span>
|   Withdrawn Routes Length (2 octets)                |
<span class="hljs-code">+-----------------------------------------------------+</span>
|   Withdrawn Routes (variable)                       |
<span class="hljs-code">+-----------------------------------------------------+</span>
|   Total Path Attribute Length (2 octets)            |
<span class="hljs-code">+-----------------------------------------------------+</span>
|   Path Attributes (variable)                        |
<span class="hljs-code">+-----------------------------------------------------+</span>
|   Network Layer Reachability Information (variable) |
<span class="hljs-code">+-----------------------------------------------------+</span></code></pre>

<p><code>Withdrawn Routes</code>中是一些<code>IP address prefix</code>，每个<code>IP address prefix</code>都是<code>&lt;length, prefix&gt;</code>的二元组</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+---------------------------+</span>
|   Length (1 octet)        |
<span class="hljs-code">+---------------------------+</span>
|   Prefix (variable)       |
<span class="hljs-code">+---------------------------+</span></code></pre>

<p>每个<code>Path Attributes</code>都是一组<code>&lt;attribute type, attribute length, attribute value&gt;</code>三元组</p>
<p><code>Attribute Type</code>是二个字节的字段。<code>Attr. Flags</code>、<code>Attr. Type Code</code>均一个字节</p>
<pre><code class="hljs asciidoc">0                   1
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+
|  Attr. Flags  |Attr. Type Code|
<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-<span class="hljs-code">+-+</span>-+</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271.html#section-4.3">=&gt; RFC4271 Sec 4.3</a></p>
<p><code>Attr. Flags</code>每个<code>bits</code>的<code>0/1</code>均有不同的含义，例如第四个<code>bit</code>（<code>bit 3</code>）表示是否是一个<code>Extended</code>长度的比特位，如果为0，则<code>Attribute Length</code>是1个字节，如果为1，则是2个字节</p>
<p><code>Attr. Type Code</code>值如下</p>
<p><img src="../../themes/fluid/source/img/BGP-Format/BGP-Update-Path-Attribute.png" srcset="/img/loading.gif" alt="BGP-Update-Path-Attribute"></p>
<p>整个结构如下</p>
<pre><code class="hljs mermaid">graph LR
X(Path Attributes)--&gt; T1(tuple)
T1(tuple)--&gt; A(attribute type)
A--&gt;A1(Attr. Flags)
A--&gt;A2(Attr. Type Code)
T1(tuple)--&gt; B(attribute length)
T1(tuple)--&gt; C(attribute value)
X(Path Attributes)--&gt; T2(...)</code></pre>

<h4 id="1-ORIGIN"><a href="#1-ORIGIN" class="headerlink" title="(1) ORIGIN"></a>(1) ORIGIN</h4><p><code>Type Code</code>为1<br><code>Attribute Len</code>为1<br><code>Attribute Value</code>可以为<code>IGP(0)</code>，<code>EGP(1)</code>，<code>INCOMPLETE(2)</code></p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271.html#section-4.3">=&gt; RFC4271 Sec 4.3</a></p>
<h4 id="2-AS-PATH"><a href="#2-AS-PATH" class="headerlink" title="(2) AS_PATH"></a>(2) AS_PATH</h4><p><code>Type Code</code>为2<br><code>Attribute Len</code>为变长<br><code>Attribute Value</code>为一组<code>AS path segments</code>，每一个<code>AS path segments</code>表示为<code>&lt;path segment type（1字节）, path segment length（1字节）, path segment value（变长）&gt;</code>三元组，</p>
<p><code>path segment type</code>可以为<code>AS_SET(1)</code>，<code>AS_SEQUENCE(2)</code><br><code>path segment length</code>为<code>ASes</code>的个数（不是<code>path segment value</code>的字节长度）<br><code>path segment value</code>为一个或多个<code>AS</code>编号，每个编号2个字节</p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271.html#section-4.3">=&gt; RFC4271 Sec 4.3</a></p>
<p>整个结构如下</p>
<pre><code class="hljs mermaid">graph LR
X(Attribute Value)--&gt; T1(AS path segments)
T1(AS path segments)--&gt; A(path segment type)
T1(AS path segments)--&gt; B(path segment length)
T1(AS path segments)--&gt; C(path segment value)
C(path segment value)--&gt; C1(AS number)
C(path segment value)--&gt; C2(...)
X(Path Attributes)--&gt; T2(...)</code></pre>

<h4 id="3-NEXT-HOP"><a href="#3-NEXT-HOP" class="headerlink" title="(3) NEXT_HOP"></a>(3) NEXT_HOP</h4><p><code>Type Code</code>为3<br><code>Attribute Len</code>为4<br><code>Attribute Value</code>为<code>IP address</code></p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271.html#section-4.3">=&gt; RFC4271 Sec 4.3</a></p>
<h4 id="4-MULTI-EXIT-DISC"><a href="#4-MULTI-EXIT-DISC" class="headerlink" title="(4) MULTI_EXIT_DISC"></a>(4) MULTI_EXIT_DISC</h4><p><code>Type Code</code>为4<br><code>Attribute Len</code>为4<br><code>Attribute Value</code>为4个字节的无符号整数，用于区别邻居自治域的入口点</p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271.html#section-4.3">=&gt; RFC4271 Sec 4.3</a></p>
<h4 id="5-LOCAL-PREF"><a href="#5-LOCAL-PREF" class="headerlink" title="(5) LOCAL_PREF"></a>(5) LOCAL_PREF</h4><p><code>Type Code</code>为5<br><code>Attribute Len</code>为4<br><code>Attribute Value</code>为4个字节的无符号整数，用于通知内部对等节点，广告路由的偏好程度（不是很理解）</p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271.html#section-4.3">=&gt; RFC4271 Sec 4.3</a></p>
<h4 id="6-ATOMIC-AGGREGATE"><a href="#6-ATOMIC-AGGREGATE" class="headerlink" title="(6) ATOMIC_AGGREGATE"></a>(6) ATOMIC_AGGREGATE</h4><p><code>Type Code</code>为6<br><code>Attribute Len</code>为0</p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4271.html#section-4.3">=&gt; RFC4271 Sec 4.3</a></p>
<h4 id="7-AGGREGATOR"><a href="#7-AGGREGATOR" class="headerlink" title="(7) AGGREGATOR"></a>(7) AGGREGATOR</h4><p><code>Type Code</code>为7<br><code>Attribute Len</code>为6（某些实现下为8，即<code>AS number(4字节)</code>）<br><code>Attribute Value</code>为<code>the last AS number(2字节)</code>，<code>the IP address(4字节)</code></p>
<h4 id="8-COMMUNITIES"><a href="#8-COMMUNITIES" class="headerlink" title="(8) COMMUNITIES"></a>(8) COMMUNITIES</h4><p><code>Type Code</code>为8<br><code>Attribute Len</code>为变长<br><code>Attribute Value</code>为一组4字节的<code>community</code></p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc1997.html">=&gt; RFC1997</a></p>
<h4 id="9-ORIGINATOR-ID"><a href="#9-ORIGINATOR-ID" class="headerlink" title="(9) ORIGINATOR_ID"></a>(9) ORIGINATOR_ID</h4><p><code>Type Code</code>为9<br><code>Attribute Len</code>为4<br><code>Attribute Value</code>为本地自治域的<code>BGP Identifier</code></p>
<p><code>ORIGINATOR_ID</code>和<code>CLUSTER_LIST</code>一起是防止路由环路的</p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4456.html#section-8">=&gt; RFC4456 Sec 8.</a></p>
<h4 id="10-CLUSTER-LIST"><a href="#10-CLUSTER-LIST" class="headerlink" title="(10) CLUSTER_LIST"></a>(10) CLUSTER_LIST</h4><p><code>Type Code</code>为10<br><code>Attribute Len</code>为变长<br><code>Attribute Value</code>为一组4字节的<code>CLUSTER_ID</code></p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4456.html#section-8">=&gt; RFC4456 Sec 8.</a></p>
<h4 id="14-MP-REACH-NLRI"><a href="#14-MP-REACH-NLRI" class="headerlink" title="(14) MP_REACH_NLRI"></a>(14) MP_REACH_NLRI</h4><p><code>Type Code</code>为14<br><code>Attribute Len</code>为变长<br><code>Attribute Value</code>为<code>AFI(2字节)</code>、<code>SAFI(1字节)</code>、<code>Length of Next Hop Network Address(1字节)</code>、<code>Network Address of Next Hop(变长)</code>、<code>Reserved(1字节)</code>、<code>NLRI(变长)</code></p>
<p><code>Network Address of Next Hop</code>和<code>NLRI</code>均由<code>&lt;AFI, SAFI&gt;</code>标识</p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+---------------------------------------------------------+</span>
| Address Family Identifier (2 octets)                    |
<span class="hljs-code">+---------------------------------------------------------+</span>
| Subsequent Address Family Identifier (1 octet)          |
<span class="hljs-code">+---------------------------------------------------------+</span>
| Length of Next Hop Network Address (1 octet)            |
<span class="hljs-code">+---------------------------------------------------------+</span>
| Network Address of Next Hop (variable)                  |
<span class="hljs-code">+---------------------------------------------------------+</span>
| Reserved (1 octet)                                      |
<span class="hljs-code">+---------------------------------------------------------+</span>
| Network Layer Reachability Information (variable)       |
<span class="hljs-code">+---------------------------------------------------------+</span></code></pre>

<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4760.html#section-3">=&gt; RFC4760 Sec 3.</a></p>
<h4 id="15-MP-UNREACH-NLRI"><a href="#15-MP-UNREACH-NLRI" class="headerlink" title="(15) MP_UNREACH_NLRI"></a>(15) MP_UNREACH_NLRI</h4><p><code>Type Code</code>为15<br><code>Attribute Len</code>为变长<br><code>Attribute Value</code>为<code>AFI(2字节)</code>、<code>SAFI(1字节)</code>、<code>Withdrawn Routes(变长)</code></p>
<pre><code class="hljs asciidoc"><span class="hljs-code">+---------------------------------------------------------+</span>
| Address Family Identifier (2 octets)                    |
<span class="hljs-code">+---------------------------------------------------------+</span>
| Subsequent Address Family Identifier (1 octet)          |
<span class="hljs-code">+---------------------------------------------------------+</span>
| Withdrawn Routes (variable)                             |
<span class="hljs-code">+---------------------------------------------------------+</span></code></pre>

<p><code>Withdrawn Routes</code>由<code>&lt;AFI, SAFI&gt;</code>标识</p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4760.html#section-4">=&gt; RFC4760 Sec 4.</a></p>
<h4 id="16-EXTENDED-COMMUNITIES"><a href="#16-EXTENDED-COMMUNITIES" class="headerlink" title="(16) EXTENDED COMMUNITIES"></a>(16) EXTENDED COMMUNITIES</h4><p><code>Type Code</code>为16<br><code>Attribute Len</code>为变长<br><code>Attribute Value</code>为一系列<code>extended communities</code>，每个<code>Extended Community</code>均是8个字节的如下结构</p>
<p>如果是<code>Regular type</code>，则是1个字节，如果是<code>Extended type</code>，则是2个字节</p>
<pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">Type Field  :</span> <span class="hljs-number">1</span> <span class="hljs-string">or</span> <span class="hljs-number">2</span> <span class="hljs-string">octets</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Value Field :</span> <span class="hljs-string">Remaining</span> <span class="hljs-string">octets</span>

 <span class="hljs-number">0</span>                   <span class="hljs-number">1</span>                   <span class="hljs-number">2</span>                   <span class="hljs-number">3</span>
 <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span> <span class="hljs-number">2</span> <span class="hljs-number">3</span> <span class="hljs-number">4</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">7</span> <span class="hljs-number">8</span> <span class="hljs-number">9</span> <span class="hljs-number">0</span> <span class="hljs-number">1</span>
<span class="hljs-string">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>
<span class="hljs-string">|</span>  <span class="hljs-string">Type</span> <span class="hljs-string">high</span>    <span class="hljs-string">|</span>  <span class="hljs-string">Type</span> <span class="hljs-string">low(*)</span>  <span class="hljs-string">|</span>                               <span class="hljs-string">|</span>
<span class="hljs-string">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span>          <span class="hljs-string">Value</span>                <span class="hljs-string">|</span>
<span class="hljs-string">|</span>                                                               <span class="hljs-string">|</span>
<span class="hljs-string">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span></code></pre>

<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc4360.html#section-2">=&gt; RFC4360 Sec 2.</a></p>
<h4 id="17-AS4-PATH"><a href="#17-AS4-PATH" class="headerlink" title="(17) AS4_PATH"></a>(17) AS4_PATH</h4><p><code>Type Code</code>为17<br><code>Attribute Len</code>为4<br><code>Attribute Value</code>为4字节的<code>AS4_PATH</code></p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc6793.html#section-9">=&gt; RFC6793 Sec 9.</a></p>
<h4 id="18-AS4-AGGREGATOR"><a href="#18-AS4-AGGREGATOR" class="headerlink" title="(18) AS4_AGGREGATOR"></a>(18) AS4_AGGREGATOR</h4><p><code>Type Code</code>为18<br><code>Attribute Len</code>为8<br><code>Attribute Value</code>为<code>the last AS number(4字节)</code>，<code>the IP address(4字节)</code></p>
<p><a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc6793.html#section-9">=&gt; RFC6793 Sec 9.</a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/protocol/">protocol</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/BGP/">BGP</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/07/20/ASA%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">
                        <span class="hidden-mobile">ASA 环境搭建</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "BGP协议格式记录&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
